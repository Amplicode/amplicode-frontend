import * as React from "react";
import {observer} from "mobx-react";
import {<%= entity.className %>} from "<%= relDirShift %>cuba/entities/<%= entity.name %>";
import {Card, Icon} from "antd";
import {collection} from "@cuba-platform/react-core";
import {EntityProperty} from "@cuba-platform/react-ui";

@observer
export class <%= className %> extends React.Component {

  dataCollection = collection<<%= entity.className %>>(<%= entity.className %>.NAME, {view: '<%=view.name%>', sort: '-updateTs'});
  fields = [<% attributes.forEach(p => { %>
    '<%= p.name %>',
    <% }) %>
    ];

  render() {
  const {status, items} = this.dataCollection;

    if (status === "LOADING") {
      return <Icon type='spin'/>
    }

    return (
      <div className='narrow-layout'>
        {items.map(e =>
        <% /* todo null check of e.id will be removed after we strict id type in https://github.com/cuba-platform/frontend/issues/119 */ %>
        <Card title={e._instanceName}
              key={e.id ? e.id : undefined}
              style={{marginBottom: '12px'}}>
            {this.fields.map(p =>
              <EntityProperty entityName={<%= entity.className %>.NAME}
                              propertyName={p}
                              value={e[p]}
                              key={p}/>
            )}
          </Card>
        )}
      </div>
    )
  }
}
